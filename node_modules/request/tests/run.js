var spawn = require('child_process').spawn
  , exitCode = 0
  ;

var tests = [
    'tests-body.js'
  , 'tests-cookie.js'
  , 'tests-cookiejar.js'
  , 'tests-defaults.js'
  , 'tests-errors.js'
  , 'tests-headers.js'
  , 'tests-httpModule.js'
  , 'tests-https.js'
  , 'tests-oauth.js'
  , 'tests-pipes.js'
  , 'tests-proxy.js'
  , 'tests-qs.js'
  , 'tests-redirect.js'
  , 'tests-timeout.js'
] 

var next = function () {
  if (tests.length === 0) process.exit(exitCode);
  
  var file = tests.shift()
  console.log(file)
  var proc = spawn('node', [ 'tests/' + file ])
  proc.stdout.pipe(process.stdout)
  proc.stderr.pipe(process.stderr)
  proc.on('exit', function (code) {
  	exitCode += code || 0
  	next()
  })
}
next()